# ScyllaDB to Postgres CDC Pipeline - Environment Configuration
# Copy this file to .env and customize for your environment

# ============================================================================
# ScyllaDB Configuration
# ============================================================================
SCYLLA_HOSTS=scylla:9042
SCYLLA_KEYSPACE=ecommerce
SCYLLA_REPLICATION_FACTOR=1  # Use 3 in production
SCYLLA_USERNAME=
SCYLLA_PASSWORD=

# ============================================================================
# PostgreSQL Configuration
# ============================================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=warehouse
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres  # Change in production!
POSTGRES_SSLMODE=disable    # Use 'require' in production with TLS

# ============================================================================
# Kafka Configuration
# ============================================================================
KAFKA_BROKERS=kafka:9092
KAFKA_REPLICATION_FACTOR=1  # Use 3 in production
KAFKA_NUM_PARTITIONS=8
KAFKA_RETENTION_MS=86400000  # 24 hours (increase for production)

# ============================================================================
# Schema Registry Configuration
# ============================================================================
SCHEMA_REGISTRY_URL=http://schema-registry:8081
SCHEMA_COMPATIBILITY_MODE=BACKWARD

# ============================================================================
# Kafka Connect Configuration
# ============================================================================
CONNECT_GROUP_ID=cdc-connect-cluster
CONNECT_CONFIG_STORAGE_TOPIC=connect-configs
CONNECT_OFFSET_STORAGE_TOPIC=connect-offsets
CONNECT_STATUS_STORAGE_TOPIC=connect-status
CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR=1  # Use 3 in production
CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR=1  # Use 3 in production
CONNECT_STATUS_STORAGE_REPLICATION_FACTOR=1  # Use 3 in production

# Connector names
SOURCE_CONNECTOR_NAME=scylla-cdc-source
SINK_CONNECTOR_NAME=postgres-jdbc-sink

# Source connector topic configuration
CDC_TOPIC_PREFIX=cdc.scylla
CDC_SCYLLA_CLUSTER_NAME=scylla-cluster
CDC_HEARTBEAT_TOPIC_PREFIX=heartbeat.scylla
CDC_SCHEMA_HISTORY_TOPIC=scylla-schema-history
CDC_SOURCE_DLQ_TOPIC=dlq-scylla-cdc-source

# Sink connector topic configuration
SINK_TOPICS_REGEX="scylla-cluster\\.app_data\\.(users|orders|order_items|products|inventory_transactions)"
SINK_DLQ_TOPIC=dlq-postgres-sink

# ============================================================================
# HashiCorp Vault Configuration
# ============================================================================
VAULT_ADDR=http://vault:8200
VAULT_TOKEN=dev-token  # Auto-generated in dev mode, use proper auth in production
VAULT_SECRETS_PATH=cdc
VAULT_DEV_MODE=true    # Set to false in production

# ============================================================================
# Monitoring Configuration
# ============================================================================
PROMETHEUS_PORT=9090
PROMETHEUS_SCRAPE_INTERVAL=15s
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin  # Change in production!
JAEGER_UI_PORT=16686
JAEGER_COLLECTOR_PORT=14268

# ============================================================================
# Application Configuration
# ============================================================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
ENVIRONMENT=development  # development, staging, production

# ============================================================================
# Performance Tuning
# ============================================================================
# Connector parallelism
CONNECTOR_TASKS_MAX=4

# CDC Latency Tuning (see docs/CDC_LAG.md)
# Source connector settings
CDC_SOURCE_HEARTBEAT_INTERVAL_MS=30000      # Default: 30s, Low-latency: 10000, Ultra-low: 1000
CDC_SOURCE_POLL_INTERVAL_MS=1000            # Default: 1000ms, Ultra-low: 100-500
CDC_SOURCE_MAX_BATCH_SIZE=2048              # Default: 2048, Streaming: 1

# Sink connector batch settings
SINK_BATCH_SIZE=3000                        # Default: 3000, Low-latency: 200, Ultra-low: 1
SINK_CONSUMER_MAX_POLL_RECORDS=1000         # Default: 1000, Low-latency: 200, Ultra-low: 1
SINK_LINGER_MS=100

# Retry configuration
MAX_RETRIES=10
RETRY_BACKOFF_MS=3000

# ============================================================================
# Reconciliation Configuration
# ============================================================================
RECONCILIATION_BATCH_SIZE=10000
RECONCILIATION_CHECKPOINT_INTERVAL=10000
RECONCILIATION_SCHEDULE="0 2 * * *"  # Daily at 2 AM (cron format)

# ============================================================================
# Alerting Configuration
# ============================================================================
ALERT_LAG_THRESHOLD_SECONDS=10
ALERT_ERROR_RATE_THRESHOLD=0.01
ALERT_DLQ_SIZE_THRESHOLD=0
